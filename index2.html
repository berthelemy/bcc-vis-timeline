<!DOCTYPE HTML>
<html>
<head>
  <title>Timeline basic demo</title>

  <!-- Load jquery for ajax support -->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  <script src="node_modules/vis/dist/vis.js"></script>
  
  <link href="node_modules/vis/dist/vis.css" rel="stylesheet" type="text/css" />

  <style type="text/css">
    body, html {
      font-family: sans-serif;
    }
  </style>
</head>
<body>

<h1>Load external data</h1>

<div id="visualization"></div>


<script>


 
 // ID of the Google Spreadsheet
 var spreadsheetID = "15TidIQ9YgnEinL3YAJwX8HEoVHM4xPTiLpnC_XtFi5c";
 
 // Make sure it is public or set to Anyone with link can view 
 var url = "https://spreadsheets.google.com/feeds/list/" + spreadsheetID + "/od1/public/values?alt=json&callback=";
 


 $.getJSON(url, function(data) {
  var i = 0;
  var entry = data.feed.entry;
  var visData = [];
  var groups = [];
  var id

  $(entry).each(function(){
    
    //console.log(entry);
    $content = this.gsx$headline.$t;
    $start = this.gsx$startdate.$t;
    $end = this.gsx$enddate.$t;
    $group = this.gsx$group.$t;

    
    
    start = dateFormat($start);

    visData[i] = {
        id:i+1,
        content:$content,
        start:start,
        group:$group
    };

    
    if ($end) {
      end = dateFormat($end); 
      visData[i].end = end; 
    }
    





//console.log(visData);

    i++;

    
  });


  var container = document.getElementById('visualization');
  // Create a DataSet (allows two way data-binding)
  var items = new vis.DataSet(visData);
  
  extractGroups = listGroups(visData);
  var groups = new vis.DataSet();

  for (var g = 0; g < extractGroups.length; g++) {
    groups.add({id: g, content: extractGroups[g]});
  }

console.log(groups);
  

  var items = new vis.DataSet(visData);
  var options = {
 //   groupOrder: 'content',  // groupOrder can be a property name or a sorting function
    align: "left"
  };

  var timeline = new vis.Timeline(container);
  timeline.setOptions(options);
  timeline.setGroups(groups);
  timeline.setItems(items);


    
 
      //console.log(items);

      

      
      

      // Create a Timeline
      var timeline = new vis.Timeline(container, items, options);

 });

 // console.log(visData[1]);

//console.log(dateFormat(date));
function dateFormat(date) {
  firstSlash = date.indexOf('/');
  lastSlash = date.lastIndexOf('/');
  year = date.slice(lastSlash + 1,date.length);
  month = date.slice(0,firstSlash)-1; // JS months are zero indexed
  day = date.slice(firstSlash+1,lastSlash);
//  console.log(date, year, month, day);

  var date2 = new Date(year, month, day,0,0,0,0);
//console.log(date2);  

  return date2;
}


function listGroups(inputArray) {

    var outputArray = [];

    var distinct = []
    for (var i = 0; i < inputArray.length; i++) {
      if (outputArray.indexOf(inputArray[i].group) == -1) {
      
        outputArray.push(inputArray[i].group);
      }
    }
   
   
    return outputArray;
}


</script>


</body>
</html>